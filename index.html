<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RealData Immo - Assistant Expert</title>
    <style>
        body { font-family: sans-serif; background: #f4f7f6; display: flex; justify-content: center; padding: 20px; color: #333; }
        #chat-container { width: 100%; max-width: 700px; background: white; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); overflow: hidden; display: flex; flex-direction: column; height: 85vh; }
        #chat-box { flex: 1; padding: 25px; overflow-y: auto; display: flex; flex-direction: column; gap: 12px; background: #fcfcfc; }
        .msg { padding: 12px 16px; border-radius: 15px; max-width: 85%; line-height: 1.5; font-size: 15px; }
        .bot { background: #f0f4f8; align-self: flex-start; color: #2c3e50; border-bottom-left-radius: 2px; border: 1px solid #d1d9e0; }
        .user { background: #2c3e50; color: white; align-self: flex-end; border-bottom-right-radius: 2px; }
        #input-area { padding: 20px; border-top: 1px solid #eee; display: flex; gap: 10px; background: white; }
        input { flex: 1; padding: 12px 20px; border: 1px solid #ddd; border-radius: 30px; outline: none; font-size: 15px; }
        button { background: #3498db; color: white; border: none; padding: 10px 25px; border-radius: 30px; cursor: pointer; font-weight: bold; transition: 0.2s; }
        button:hover { background: #2980b9; }
        #btn-reset { display: none; background: #e74c3c; margin: 15px; align-self: center; }
    </style>
</head>
<body>

<div id="chat-container">
    <div id="chat-box"></div>
    <div id="input-area">
        <input type="text" id="user-input" placeholder="RÃ©pondez ici...">
        <button id="btn-valider">Valider</button>
    </div>
    <button id="btn-reset" onclick="location.reload()">RÃ©initialiser l'Analyse</button>
</div>

<script>
// --- CONFIGURATION DES PARCOURS ---
const parcours = {
    MAISON: [
        { q: "1. Prix Net Vendeur (â‚¬) ?", cle: "prix" },
        { q: "2. Honoraires d'agence (â‚¬) ?", cle: "honoraires" },
        { q: "3. Surface habitable (mÂ²) ?", cle: "surface" },
        { q: "4. DPE (A Ã  G) ?", cle: "dpe" },
        { q: "5. Taxe FonciÃ¨re (â‚¬) ?", cle: "taxe" },
        { q: "6. Ã‰tat technique (Toiture/Isolation) ?", cle: "technique" },
        { q: "7. Adresse prÃ©cise ?", cle: "adresse" },
        { q: "8. Potentiel identifiÃ© ?", cle: "potentiel" }
    ],
    IMMEUBLE: [
        { q: "1. Prix Net Vendeur (â‚¬) ?", cle: "prix" },
        { q: "2. Honoraires (â‚¬) ?", cle: "honoraires" },
        { q: "3. Nombre de lots ?", cle: "lots" },
        { q: "4. Loyers annuels HC (â‚¬) ?", cle: "loyer" },
        { q: "5. Taxe FonciÃ¨re (â‚¬) ?", cle: "taxe" },
        { q: "6. Ã‰tat du Gros Å’uvre ?", cle: "technique" },
        { q: "7. Adresse ?", cle: "adresse" },
        { q: "8. Potentiel de division ?", cle: "potentiel" }
    ]
    // Note : Tu peux rajouter TERRAIN, PARKING, etc. ici plus tard.
};

let typeBien = null, index = 0, reponses = {};

// --- FONCTIONS DE L'INTERFACE ---
function ajouterMessage(texte, auteur) {
    const box = document.getElementById("chat-box");
    const div = document.createElement("div");
    div.className = `msg ${auteur}`;
    div.innerHTML = texte;
    box.appendChild(div);
    box.scrollTop = box.scrollHeight;
}

function traiterSaisie() {
    const input = document.getElementById("user-input");
    const texte = input.value.trim();
    if (texte === "") return;

    ajouterMessage(texte, "user");
    input.value = "";

    if (!typeBien) {
        const choix = texte.toUpperCase();
        if (parcours[choix]) {
            typeBien = choix;
            setTimeout(() => {
                ajouterMessage(`Analyse lancÃ©e pour : <strong>${typeBien}</strong>.`, "bot");
                setTimeout(() => ajouterMessage(parcours[typeBien][0].q, "bot"), 500);
            }, 300);
        } else {
            ajouterMessage("Veuillez choisir entre : MAISON ou IMMEUBLE.", "bot");
        }
    } else {
        const questions = parcours[typeBien];
        reponses[questions[index].cle] = texte;
        index++;

        if (index < questions.length) {
            setTimeout(() => ajouterMessage(questions[index].q, "bot"), 400);
        } else {
            finaliser();
        }
    }
}

// --- MOTEUR DE CALCUL EXPERT ---
function finaliser() {
    const p = parseFloat(reponses.prix) || 0;
    const h = parseFloat(reponses.honoraires) || 0;
    const total = p + h;
    const loyer = parseFloat(reponses.loyer) || 0;
    const taxe = parseFloat(reponses.taxe) || 0;
    const dpe = reponses.dpe ? reponses.dpe.toUpperCase() : "N/A";

    let indicateurs = "";
    let score = 6;

    // Calcul Rendement (si applicable)
    if (loyer > 0) {
        const rBrut = ((loyer / total) * 100).toFixed(2);
        const rNet = (((loyer - taxe) / total) * 100).toFixed(2);
        indicateurs += `<p style="color:#27ae60;"><strong>ðŸ“ˆ Rendement Brut :</strong> ${rBrut}%</p>`;
        indicateurs += `<p style="color:#2ecc71;"><strong>ðŸ’° Rendement Net :</strong> ${rNet}%</p>`;
        if (parseFloat(rBrut) > 8) score += 1;
    }

    // Impact DPE
    if (["A", "B"].includes(dpe)) score += 2;